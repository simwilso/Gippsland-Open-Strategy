name: Discussion Sync
on:
  issues:
    types: [opened, edited, labeled]
jobs:
  sync:
    runs-on: ubuntu-latest
    permissions: { issues: write }
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            if (!issue.labels.some(l => l.name === 'suggestion')) return;
            const reactions = await github.reactions.listForIssue({
              owner: context.repo.owner, repo: context.repo.repo, issue_number: issue.number
            });
            const up = reactions.data.filter(r => r.content === '+1').length;
            const labels = issue.labels.map(l => l.name).filter(n => !n.startsWith('votes:'));
            labels.push(`votes:${up}`);
            await github.issues.update({
              owner: context.repo.owner, repo: context.repo.repo, issue_number: issue.number, labels
            });